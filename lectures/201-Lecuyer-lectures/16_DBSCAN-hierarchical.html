
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Lecture 16: More Clustering &#8212; CPSC 330 Applied Machine Learning 2024W1</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/extra.css?v=6df0ab2b" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'lectures/201-Lecuyer-lectures/16_DBSCAN-hierarchical';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../README.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/UBC-CS-logo.png" class="logo__image only-light" alt="CPSC 330 Applied Machine Learning 2024W1 - Home"/>
    <script>document.write(`<img src="../../_static/UBC-CS-logo.png" class="logo__image only-dark" alt="CPSC 330 Applied Machine Learning 2024W1 - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../README.html">
                    UBC CPSC 330: Applied Machine Learning (2024W2)
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Things you should know</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../syllabus.html">Syllabus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/README.html">CPSC 330 Documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../learning-objectives.html">Course Learning Objectives</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Lectures</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../notes/01_intro.html">Lecture 1: Course Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/02_terminology-decision-trees.html">Lecture 2: Terminology, Baselines, Decision Trees</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/03_ml-fundamentals.html">Lecture 3: Machine Learning Fundamentals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/04_kNNs-SVM-RBF.html">Lecture 4: <span class="math notranslate nohighlight">\(k\)</span>-Nearest Neighbours and SVM RBFs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/05_preprocessing-pipelines.html">Lecture 5: Preprocessing and <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/06_column-transformer-text-feats.html">Lecture 6: <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> <code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code> and Text Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/07_linear-models.html">Lecture 7: Linear Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/08_hyperparameter-optimization.html">Lecture 8: Hyperparameter Optimization and Optimization Bias</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/09_classification-metrics.html">Lecture 9: Classification metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/10_regression-metrics.html">Lecture 10: Regression metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/12_ensembles.html">Lecture 12: Ensembles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/13_feat-importances.html">Lecture 13: Feature importances and model transparency</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/14_feature-engineering-selection.html">Lecture 14: Feature engineering and feature selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/15_K-Means.html">Lecture 15: K-Means Clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/16_DBSCAN-hierarchical.html">Lecture 16: More Clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/17_recommender-systems.html">Lecture 17: Recommender Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/18_natural-language-processing.html">Lecture 18: Introduction to natural language processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/19_intro_to_computer-vision.html">Lecture 19: Multi-class classification and introduction to computer vision</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/20_time-series.html">Lecture 20: Time series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/21_survival-analysis.html">Lecture 21: Survival analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/22_communication.html">Lecture 22: Communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/24_deployment-conclusion.html">Lecture 24: Deployment and conclusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/final-exam-review-guiding-question.html">Final exam preparation: guiding questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/appendixA_feature-engineering-text-data.html">Appendix A: Demo of feature engineering for text data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/appendixB_multiclass-strategies.html">Appendix B: Multi-class, meta-strategies</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Attribution</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../LICENSE.html">LICENSE</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/UBC-CS/cpsc330-2024W2" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/lectures/201-Lecuyer-lectures/16_DBSCAN-hierarchical.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Lecture 16: More Clustering</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lecture-plan-and-learning-outcomes">Lecture plan and learning outcomes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-outcomes">Learning outcomes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#select-all-of-the-following-statements-which-are-true-https-join-iclicker-com-fuyi">16.1 Select all of the following statements which are <strong>True</strong> https://join.iclicker.com/FUYI</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recap-and-motivation-video">Recap and motivation [video]</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#k-means-recap">K-Means recap</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#k-means-limitations">K-Means limitations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#k-means-limitations-shape-of-k-means-clusters">K-Means limitations: Shape of K-Means clusters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#k-means-failure-case-1">K-Means: failure case 1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#k-means-failure-case-2">K-Means: failure case 2</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#k-means-failure-case-3">K-Means: failure case 3</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dbscan-video">DBSCAN [video]</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dbscan-introduction">DBSCAN introduction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-does-it-work">How does it work?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#more-details-on-dbscan">More details on DBSCAN</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#question-for-you">Question for you</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluating-dbscan-clusters">Evaluating DBSCAN clusters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-pros-and-cons">Summary: Pros and cons</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dbscan-failure-cases">DBSCAN: failure cases</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">DBSCAN: failure cases</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#questions-for-you">❓❓ Questions for you</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">16.2 Select all of the following statements which are <strong>True</strong> https://join.iclicker.com/FUYI</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hierarchical-clustering-video">Hierarchical clustering [video]</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dendrogram">Dendrogram</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#questions-for-you-https-join-iclicker-com-fuyi">❓❓ Questions for you https://join.iclicker.com/FUYI</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#select-all-of-the-following-statements-which-are-true">16.3 Select all of the following statements which are <strong>True</strong></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#final-comments-summary-and-reflection">Final comments, summary, and reflection</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#take-home-message">Take-home message</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-few-comments-on-clustering-evaluation">A few comments on clustering evaluation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#resources">Resources</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p><img alt="" src="../../_images/330-banner.png" /></p>
<section class="tex2jax_ignore mathjax_ignore" id="lecture-16-more-clustering">
<h1>Lecture 16: More Clustering<a class="headerlink" href="#lecture-16-more-clustering" title="Link to this heading">#</a></h1>
<p>UBC 2024-25</p>
<p><br><br></p>
<section id="lecture-plan-and-learning-outcomes">
<h2>Lecture plan and learning outcomes<a class="headerlink" href="#lecture-plan-and-learning-outcomes" title="Link to this heading">#</a></h2>
<section id="imports">
<h3>Imports<a class="headerlink" href="#imports" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s2">&quot;..&quot;</span><span class="p">),</span> <span class="s2">&quot;code&quot;</span><span class="p">))</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">plotting_functions</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">plotting_functions_unsup</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.cluster.hierarchy</span><span class="w"> </span><span class="kn">import</span> <span class="n">dendrogram</span><span class="p">,</span> <span class="n">fcluster</span><span class="p">,</span> <span class="n">linkage</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn</span><span class="w"> </span><span class="kn">import</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">datasets</span><span class="p">,</span> <span class="n">metrics</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.cluster</span><span class="w"> </span><span class="kn">import</span> <span class="n">DBSCAN</span><span class="p">,</span> <span class="n">AgglomerativeClustering</span><span class="p">,</span> <span class="n">KMeans</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.mixture</span><span class="w"> </span><span class="kn">import</span> <span class="n">GaussianMixture</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.datasets</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_blobs</span><span class="p">,</span> <span class="n">make_moons</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.decomposition</span><span class="w"> </span><span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics.pairwise</span><span class="w"> </span><span class="kn">import</span> <span class="n">euclidean_distances</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">yellowbrick.cluster</span><span class="w"> </span><span class="kn">import</span> <span class="n">SilhouetteVisualizer</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;font.size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.max_colwidth&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/d266727bd25841d496ffe9ead10eb59519b21bf66ed3965c96e4493e43dbc624.png" src="../../_images/d266727bd25841d496ffe9ead10eb59519b21bf66ed3965c96e4493e43dbc624.png" />
</div>
</div>
<p><br><br></p>
</section>
<section id="learning-outcomes">
<h3>Learning outcomes<a class="headerlink" href="#learning-outcomes" title="Link to this heading">#</a></h3>
<p>From this lecture, students are expected to be able to:</p>
<ul class="simple">
<li><p>Identify limitations of K-Means.</p></li>
<li><p>Broadly explain how DBSCAN works.</p></li>
<li><p>Apply DBSCAN using <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>.</p></li>
<li><p>Explain the effect of epsilon and minimum samples hyperparameters in DBSCAN.</p></li>
<li><p>Explain the difference between core points, border points, and noise points in the context of DBSCAN.</p></li>
<li><p>Identify DBSCAN limitations.</p></li>
<li><p>Explain the idea of hierarchical clustering.</p></li>
<li><p>Visualize dendrograms using <code class="docutils literal notranslate"><span class="pre">scipy.cluster.hierarchy.dendrogram</span></code>.</p></li>
<li><p>Use different truncation levels in dendrogram and flatten clusters using <code class="docutils literal notranslate"><span class="pre">fcluster</span></code>.</p></li>
<li><p>Broadly explain the differences between different linkage criteria.</p></li>
<li><p>Explain the advantages and disadvantages of different clustering methods.</p></li>
<li><p>Apply clustering algorithms on image datasets and interpret clusters.</p></li>
<li><p>Recognize the impact of distance measure and representation in clustering methods.</p></li>
</ul>
<p><br><br><br><br></p>
</section>
<section id="select-all-of-the-following-statements-which-are-true-https-join-iclicker-com-fuyi">
<h3>16.1 Select all of the following statements which are <strong>True</strong> https://join.iclicker.com/FUYI<a class="headerlink" href="#select-all-of-the-following-statements-which-are-true-https-join-iclicker-com-fuyi" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>(A) Similar to K-nearest neighbours, K-Means is a non parametric model.</p></li>
<li><p>(B) The meaning of <span class="math notranslate nohighlight">\(K\)</span> in K-nearest neighbours and K-Means clustering is very similar.</p></li>
<li><p>(C) Scaling of input features is crucial in clustering.</p></li>
<li><p>(D) In clustering, it’s almost always a good idea to find equal-sized clusters.</p></li>
</ul>
</section>
</section>
<section id="recap-and-motivation-video">
<h2>Recap and motivation [<a class="reference external" href="https://youtu.be/1ZwITQyWpkY">video</a>]<a class="headerlink" href="#recap-and-motivation-video" title="Link to this heading">#</a></h2>
<section id="k-means-recap">
<h3>K-Means recap<a class="headerlink" href="#k-means-recap" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>We discussed K-Means clustering in the previous lecture.</p></li>
<li><p>Each cluster is represented by a center.</p></li>
<li><p>Given a new point, you can assign it to a cluster by computing the distances to all cluster centers and picking the cluster with the smallest distance.</p></li>
<li><p>It’s a popular algorithm because</p>
<ul>
<li><p>It’s easy to understand and implement.</p></li>
<li><p>Runs relatively quickly and scales well to large datasets.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sklearn</span></code> has a more scalable variant called <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.cluster.MiniBatchKMeans.html"><code class="docutils literal notranslate"><span class="pre">MiniBatchKMeans</span></code></a> which can handle very large datasets.</p></li>
</ul>
</li>
</ul>
</section>
<section id="k-means-limitations">
<h3>K-Means limitations<a class="headerlink" href="#k-means-limitations" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Relies on random initialization and so the outcome may change depending upon this initialization.</p></li>
<li><p>K-Means clustering requires to specify the number of clusters in advance.</p></li>
<li><p>Very often you do not know the centers in advance. The elbow method or the silhouette method to find the optimal number of clusters are not always easy to interpret.</p></li>
<li><p>Each point has to have a cluster assignment.</p></li>
</ul>
</section>
<section id="k-means-limitations-shape-of-k-means-clusters">
<h3>K-Means limitations: Shape of K-Means clusters<a class="headerlink" href="#k-means-limitations-shape-of-k-means-clusters" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>K-Means partitions the space based on the closest mean.</p></li>
<li><p>Each cluster is defined solely by its center and so it can only capture relatively simple shapes.</p></li>
<li><p>So the boundaries between clusters are linear; It fails to identify clusters with complex shapes.
<a class="reference external" href="https://scikit-learn.org/stable/auto_examples/cluster/plot_kmeans_digits.html">Source</a>.</p></li>
</ul>
<p><img alt="" src="../../_images/kmeans_boundaries.png" /></p>
<!-- <center>
<img src="img/kmeans_boundaries.png" alt="" height="400" width="400"> 
</center>    
 -->
</section>
<section id="k-means-failure-case-1">
<h3>K-Means: failure case 1<a class="headerlink" href="#k-means-failure-case-1" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>K-Means performs poorly if the clusters have more complex shapes (e.g., two moons data below).</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_moons</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_kmeans</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/257c397c4030f6cf888c18c215cdb9e72f8fadabe0e9630a61c3fa13087663ff.png" src="../../_images/257c397c4030f6cf888c18c215cdb9e72f8fadabe0e9630a61c3fa13087663ff.png" />
</div>
</div>
</section>
<section id="k-means-failure-case-2">
<h3>K-Means: failure case 2<a class="headerlink" href="#k-means-failure-case-2" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Again, K-Means is unable to capture complex cluster shapes.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">make_circles</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_kmeans</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/485069b5179f94089114da0e6cd76e5b4491558d63af5f0fb684f3088077075e.png" src="../../_images/485069b5179f94089114da0e6cd76e5b4491558d63af5f0fb684f3088077075e.png" />
</div>
</div>
</section>
<section id="k-means-failure-case-3">
<h3>K-Means: failure case 3<a class="headerlink" href="#k-means-failure-case-3" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>It assumes that all directions are equally important for each cluster and fails to identify non-spherical clusters.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># generate some random cluster data</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_blobs</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">170</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">74</span><span class="p">)</span>
<span class="n">transformation</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">transformation</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_kmeans</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/24198d2bdfb2eec7f018543aa1e2a577a28e2f898ec2e3b6d76b47331098d7a2.png" src="../../_images/24198d2bdfb2eec7f018543aa1e2a577a28e2f898ec2e3b6d76b47331098d7a2.png" />
</div>
</div>
<ul class="simple">
<li><p>Can we do better than this?</p></li>
<li><p>Another clustering algorithm called DBSCAN is able to tackle some of these cases.</p></li>
</ul>
<p><br><br><br><br><br><br></p>
</section>
</section>
<section id="dbscan-video">
<h2>DBSCAN [<a class="reference external" href="https://youtu.be/T4NLsrUaRtg">video</a>]<a class="headerlink" href="#dbscan-video" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>D</strong>ensity-<strong>B</strong>ased <strong>S</strong>patial <strong>C</strong>lustering of <strong>A</strong>pplications with <strong>N</strong>oise</p></li>
</ul>
<section id="dbscan-introduction">
<h3>DBSCAN introduction<a class="headerlink" href="#dbscan-introduction" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>DBSCAN is a density-based clustering algorithm.</p></li>
<li><p>Intuitively, it’s based on the idea that clusters form dense regions in the data and so it works by identifying “crowded” regions in the feature space.</p></li>
<li><p>It can address some of the limitations of K-Means we saw above.</p>
<ul>
<li><p>It does not require the user to specify the number of clusters in advance.</p></li>
<li><p>It can identify points that are not part of any clusters.</p></li>
<li><p>It can capture clusters of complex shapes.</p></li>
</ul>
</li>
</ul>
<p>Let’s try <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>’s DBSCAN.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_moons</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">dbscan</span> <span class="o">=</span> <span class="n">DBSCAN</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">dbscan</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">plot_original_clustered</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">dbscan</span><span class="p">,</span> <span class="n">dbscan</span><span class="o">.</span><span class="n">labels_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/482e544887908ee02b54475fb83ac50b3c196e7cd1d387110ae56a39811583a0.png" src="../../_images/482e544887908ee02b54475fb83ac50b3c196e7cd1d387110ae56a39811583a0.png" />
</div>
</div>
<ul class="simple">
<li><p>DBSCAN is able to capture half moons shape</p></li>
<li><p>We don’t not have to specify the number of clusters.</p>
<ul>
<li><p>That said, it has two other non-trivial hyperparameters to tune.</p></li>
</ul>
</li>
<li><p>There are two examples which have not been assigned any label (noise examples).</p></li>
</ul>
<p>One more example of DBSCAN clusters capturing complex cluster shapes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">make_circles</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">dbscan</span> <span class="o">=</span> <span class="n">DBSCAN</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">min_samples</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">dbscan</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">plot_original_clustered</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">dbscan</span><span class="p">,</span> <span class="n">dbscan</span><span class="o">.</span><span class="n">labels_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/a612ad378b2ae84162852f5f7105bee488eb6fc4415b857ce2f70e0e945ac512.png" src="../../_images/a612ad378b2ae84162852f5f7105bee488eb6fc4415b857ce2f70e0e945ac512.png" />
</div>
</div>
</section>
<section id="how-does-it-work">
<h3>How does it work?<a class="headerlink" href="#how-does-it-work" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Iterative algorithm.</p></li>
<li><p>Based on the idea that clusters form dense regions in the data.</p></li>
</ul>
<p><img alt="" src="../../_images/DBSCAN_search.gif" /></p>
<!-- <center>
<img src="img/DBSCAN_search.gif" alt="" height="900" width="900"> 
</center>
 -->
<p><a class="reference external" href="https://dashee87.github.io/data%20science/general/Clustering-with-Scikit-with-GIFs/">Source</a></p>
<p>There are three kinds of points.</p>
<ul class="simple">
<li><p><strong>Core points</strong> are the points that have at least <code class="docutils literal notranslate"><span class="pre">min_samples</span></code> points within a distance of <code class="docutils literal notranslate"><span class="pre">eps</span></code> (including itself)</p></li>
<li><p><strong>Border points</strong> are connected to a core point. They are within a distance of <code class="docutils literal notranslate"><span class="pre">eps</span></code> to at least one core point but they have fewer than <code class="docutils literal notranslate"><span class="pre">min_samples</span></code> points within a distance of <code class="docutils literal notranslate"><span class="pre">eps</span></code>.</p></li>
<li><p><strong>Noise points</strong> are the points which do not belong to any cluster. In other words, the points which have less than <code class="docutils literal notranslate"><span class="pre">min_samples</span></code> points within distance <code class="docutils literal notranslate"><span class="pre">eps</span></code> of the starting point are noise points.</p></li>
</ul>
<p><strong>DBSCAN algorithm</strong></p>
<ul class="simple">
<li><p>Pick a point <span class="math notranslate nohighlight">\(p\)</span> at random.</p></li>
<li><p>Check whether <span class="math notranslate nohighlight">\(p\)</span> is a “core” point or not. You can check this by looking at the number of points within epsilon distance, and count if there are at least <code class="docutils literal notranslate"><span class="pre">min_samples</span></code> points in that neighbourhood</p></li>
<li><p>If <span class="math notranslate nohighlight">\(p\)</span> is a core point, give it a colour (label).</p></li>
<li><p>Spread the colour of <span class="math notranslate nohighlight">\(p\)</span> to all of its neighbours (with distance <code class="docutils literal notranslate"><span class="pre">eps</span></code>).</p></li>
<li><p>Check if any of the neighbours that received the colour is a core point, if yes, spread the colour to its neighbors as well.</p></li>
<li><p>Once there are no more core points left to spread the colour, pick a new unlabeled point <span class="math notranslate nohighlight">\(p\)</span> and repeat the process.</p></li>
</ul>
<p><strong>DBSCAN Analogy</strong></p>
<p>Consider DBSCAN in a social context:</p>
<ul class="simple">
<li><p>Social butterflies (🦋): Core points</p></li>
<li><p>Friends of social butterflies who are not social butterflies: Border points</p></li>
<li><p>Lone wolves (🐺): Noise points</p></li>
</ul>
<p><strong>Two main hyperparameters</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">eps</span></code>: determines what it means for points to be “close”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">min_samples</span></code>: determines the number of <strong>neighboring points</strong> we require to consider in order for a point to be part of a cluster</p></li>
</ul>
<p><strong>Effect of <code class="docutils literal notranslate"><span class="pre">eps</span></code> hyperparameter</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_blobs</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">centers</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">panel</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pn</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">panel</span><span class="w"> </span><span class="kn">import</span> <span class="n">widgets</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">panel.interact</span><span class="w"> </span><span class="kn">import</span> <span class="n">interact</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span>

<span class="n">pn</span><span class="o">.</span><span class="n">extension</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">eps</span><span class="p">):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">plot_dbscan_with_labels</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">min_samples</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><script type="esms-options">{"shimMode": true}</script><style>*[data-root-id],
*[data-root-id] > * {
  box-sizing: border-box;
  font-family: var(--jp-ui-font-family);
  font-size: var(--jp-ui-font-size1);
  color: var(--vscode-editor-foreground, var(--jp-ui-font-color1));
}

/* Override VSCode background color */
.cell-output-ipywidget-background:has(
    > .cell-output-ipywidget-background > .lm-Widget > *[data-root-id]
  ),
.cell-output-ipywidget-background:has(> .lm-Widget > *[data-root-id]) {
  background-color: transparent !important;
}
</style></div><script type="application/javascript">(function(root) {
  function now() {
    return new Date();
  }

  const force = true;
  const py_version = '3.6.2'.replace('rc', '-rc.').replace('.dev', '-dev.');
  const reloading = false;
  const Bokeh = root.Bokeh;

  // Set a timeout for this load but only if we are not already initializing
  if (typeof (root._bokeh_timeout) === "undefined" || (force || !root._bokeh_is_initializing)) {
    root._bokeh_timeout = Date.now() + 5000;
    root._bokeh_failed_load = false;
  }

  function run_callbacks() {
    try {
      root._bokeh_onload_callbacks.forEach(function(callback) {
        if (callback != null)
          callback();
      });
    } finally {
      delete root._bokeh_onload_callbacks;
    }
    console.debug("Bokeh: all callbacks have finished");
  }

  function load_libs(css_urls, js_urls, js_modules, js_exports, callback) {
    if (css_urls == null) css_urls = [];
    if (js_urls == null) js_urls = [];
    if (js_modules == null) js_modules = [];
    if (js_exports == null) js_exports = {};

    root._bokeh_onload_callbacks.push(callback);

    if (root._bokeh_is_loading > 0) {
      // Don't load bokeh if it is still initializing
      console.debug("Bokeh: BokehJS is being loaded, scheduling callback at", now());
      return null;
    } else if (js_urls.length === 0 && js_modules.length === 0 && Object.keys(js_exports).length === 0) {
      // There is nothing to load
      run_callbacks();
      return null;
    }

    function on_load() {
      root._bokeh_is_loading--;
      if (root._bokeh_is_loading === 0) {
        console.debug("Bokeh: all BokehJS libraries/stylesheets loaded");
        run_callbacks()
      }
    }
    window._bokeh_on_load = on_load

    function on_error(e) {
      const src_el = e.srcElement
      console.error("failed to load " + (src_el.href || src_el.src));
    }

    const skip = [];
    if (window.requirejs) {
      window.requirejs.config({'packages': {}, 'paths': {}, 'shim': {}});
      root._bokeh_is_loading = css_urls.length + 0;
    } else {
      root._bokeh_is_loading = css_urls.length + js_urls.length + js_modules.length + Object.keys(js_exports).length;
    }

    const existing_stylesheets = []
    const links = document.getElementsByTagName('link')
    for (let i = 0; i < links.length; i++) {
      const link = links[i]
      if (link.href != null) {
        existing_stylesheets.push(link.href)
      }
    }
    for (let i = 0; i < css_urls.length; i++) {
      const url = css_urls[i];
      const escaped = encodeURI(url)
      if (existing_stylesheets.indexOf(escaped) !== -1) {
        on_load()
        continue;
      }
      const element = document.createElement("link");
      element.onload = on_load;
      element.onerror = on_error;
      element.rel = "stylesheet";
      element.type = "text/css";
      element.href = url;
      console.debug("Bokeh: injecting link tag for BokehJS stylesheet: ", url);
      document.body.appendChild(element);
    }    var existing_scripts = []
    const scripts = document.getElementsByTagName('script')
    for (let i = 0; i < scripts.length; i++) {
      var script = scripts[i]
      if (script.src != null) {
        existing_scripts.push(script.src)
      }
    }
    for (let i = 0; i < js_urls.length; i++) {
      const url = js_urls[i];
      const escaped = encodeURI(url)
      if (skip.indexOf(escaped) !== -1 || existing_scripts.indexOf(escaped) !== -1) {
        if (!window.requirejs) {
          on_load();
        }
        continue;
      }
      const element = document.createElement('script');
      element.onload = on_load;
      element.onerror = on_error;
      element.async = false;
      element.src = url;
      console.debug("Bokeh: injecting script tag for BokehJS library: ", url);
      document.head.appendChild(element);
    }
    for (let i = 0; i < js_modules.length; i++) {
      const url = js_modules[i];
      const escaped = encodeURI(url)
      if (skip.indexOf(escaped) !== -1 || existing_scripts.indexOf(escaped) !== -1) {
        if (!window.requirejs) {
          on_load();
        }
        continue;
      }
      var element = document.createElement('script');
      element.onload = on_load;
      element.onerror = on_error;
      element.async = false;
      element.src = url;
      element.type = "module";
      console.debug("Bokeh: injecting script tag for BokehJS library: ", url);
      document.head.appendChild(element);
    }
    for (const name in js_exports) {
      const url = js_exports[name];
      const escaped = encodeURI(url)
      if (skip.indexOf(escaped) >= 0 || root[name] != null) {
        if (!window.requirejs) {
          on_load();
        }
        continue;
      }
      var element = document.createElement('script');
      element.onerror = on_error;
      element.async = false;
      element.type = "module";
      console.debug("Bokeh: injecting script tag for BokehJS library: ", url);
      element.textContent = `
      import ${name} from "${url}"
      window.${name} = ${name}
      window._bokeh_on_load()
      `
      document.head.appendChild(element);
    }
    if (!js_urls.length && !js_modules.length) {
      on_load()
    }
  };

  function inject_raw_css(css) {
    const element = document.createElement("style");
    element.appendChild(document.createTextNode(css));
    document.body.appendChild(element);
  }

  const js_urls = ["https://cdn.holoviz.org/panel/1.6.0/dist/bundled/reactiveesm/es-module-shims@^1.10.0/dist/es-module-shims.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-3.6.2.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-gl-3.6.2.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-widgets-3.6.2.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-tables-3.6.2.min.js", "https://cdn.holoviz.org/panel/1.6.0/dist/panel.min.js"];
  const js_modules = [];
  const js_exports = {};
  const css_urls = [];
  const inline_js = [    function(Bokeh) {
      Bokeh.set_log_level("info");
    },
function(Bokeh) {} // ensure no trailing comma for IE
  ];

  function run_inline_js() {
    if ((root.Bokeh !== undefined) || (force === true)) {
      for (let i = 0; i < inline_js.length; i++) {
        try {
          inline_js[i].call(root, root.Bokeh);
        } catch(e) {
          if (!reloading) {
            throw e;
          }
        }
      }
      // Cache old bokeh versions
      if (Bokeh != undefined && !reloading) {
        var NewBokeh = root.Bokeh;
        if (Bokeh.versions === undefined) {
          Bokeh.versions = new Map();
        }
        if (NewBokeh.version !== Bokeh.version) {
          Bokeh.versions.set(NewBokeh.version, NewBokeh)
        }
        root.Bokeh = Bokeh;
      }
    } else if (Date.now() < root._bokeh_timeout) {
      setTimeout(run_inline_js, 100);
    } else if (!root._bokeh_failed_load) {
      console.log("Bokeh: BokehJS failed to load within specified timeout.");
      root._bokeh_failed_load = true;
    }
    root._bokeh_is_initializing = false
  }

  function load_or_wait() {
    // Implement a backoff loop that tries to ensure we do not load multiple
    // versions of Bokeh and its dependencies at the same time.
    // In recent versions we use the root._bokeh_is_initializing flag
    // to determine whether there is an ongoing attempt to initialize
    // bokeh, however for backward compatibility we also try to ensure
    // that we do not start loading a newer (Panel>=1.0 and Bokeh>3) version
    // before older versions are fully initialized.
    if (root._bokeh_is_initializing && Date.now() > root._bokeh_timeout) {
      // If the timeout and bokeh was not successfully loaded we reset
      // everything and try loading again
      root._bokeh_timeout = Date.now() + 5000;
      root._bokeh_is_initializing = false;
      root._bokeh_onload_callbacks = undefined;
      root._bokeh_is_loading = 0
      console.log("Bokeh: BokehJS was loaded multiple times but one version failed to initialize.");
      load_or_wait();
    } else if (root._bokeh_is_initializing || (typeof root._bokeh_is_initializing === "undefined" && root._bokeh_onload_callbacks !== undefined)) {
      setTimeout(load_or_wait, 100);
    } else {
      root._bokeh_is_initializing = true
      root._bokeh_onload_callbacks = []
      const bokeh_loaded = root.Bokeh != null && (root.Bokeh.version === py_version || (root.Bokeh.versions !== undefined && root.Bokeh.versions.has(py_version)));
      if (!reloading && !bokeh_loaded) {
        if (root.Bokeh) {
          root.Bokeh = undefined;
        }
        console.debug("Bokeh: BokehJS not loaded, scheduling load and callback at", now());
      }
      load_libs(css_urls, js_urls, js_modules, js_exports, function() {
        console.debug("Bokeh: BokehJS plotting callback run at", now());
        run_inline_js();
      });
    }
  }
  // Give older versions of the autoload script a head-start to ensure
  // they initialize before we start loading newer version.
  setTimeout(load_or_wait, 100)
}(window));</script><script type="application/javascript">
if ((window.PyViz === undefined) || (window.PyViz instanceof HTMLElement)) {
  window.PyViz = {comms: {}, comm_status:{}, kernels:{}, receivers: {}, plot_index: []}
}


    function JupyterCommManager() {
    }

    JupyterCommManager.prototype.register_target = function(plot_id, comm_id, msg_handler) {
      if (window.comm_manager || ((window.Jupyter !== undefined) && (Jupyter.notebook.kernel != null))) {
        var comm_manager = window.comm_manager || Jupyter.notebook.kernel.comm_manager;
        comm_manager.register_target(comm_id, function(comm) {
          comm.on_msg(msg_handler);
        });
      } else if ((plot_id in window.PyViz.kernels) && (window.PyViz.kernels[plot_id])) {
        window.PyViz.kernels[plot_id].registerCommTarget(comm_id, function(comm) {
          comm.onMsg = msg_handler;
        });
      } else if (typeof google != 'undefined' && google.colab.kernel != null) {
        google.colab.kernel.comms.registerTarget(comm_id, (comm) => {
          var messages = comm.messages[Symbol.asyncIterator]();
          function processIteratorResult(result) {
            var message = result.value;
            console.log(message)
            var content = {data: message.data, comm_id};
            var buffers = []
            for (var buffer of message.buffers || []) {
              buffers.push(new DataView(buffer))
            }
            var metadata = message.metadata || {};
            var msg = {content, buffers, metadata}
            msg_handler(msg);
            return messages.next().then(processIteratorResult);
          }
          return messages.next().then(processIteratorResult);
        })
      }
    }

    JupyterCommManager.prototype.get_client_comm = function(plot_id, comm_id, msg_handler) {
      if (comm_id in window.PyViz.comms) {
        return window.PyViz.comms[comm_id];
      } else if (window.comm_manager || ((window.Jupyter !== undefined) && (Jupyter.notebook.kernel != null))) {
        var comm_manager = window.comm_manager || Jupyter.notebook.kernel.comm_manager;
        var comm = comm_manager.new_comm(comm_id, {}, {}, {}, comm_id);
        if (msg_handler) {
          comm.on_msg(msg_handler);
        }
      } else if ((plot_id in window.PyViz.kernels) && (window.PyViz.kernels[plot_id])) {
        var comm = window.PyViz.kernels[plot_id].connectToComm(comm_id);
        comm.open();
        if (msg_handler) {
          comm.onMsg = msg_handler;
        }
      } else if (typeof google != 'undefined' && google.colab.kernel != null) {
        var comm_promise = google.colab.kernel.comms.open(comm_id)
        comm_promise.then((comm) => {
          window.PyViz.comms[comm_id] = comm;
          if (msg_handler) {
            var messages = comm.messages[Symbol.asyncIterator]();
            function processIteratorResult(result) {
              var message = result.value;
              var content = {data: message.data};
              var metadata = message.metadata || {comm_id};
              var msg = {content, metadata}
              msg_handler(msg);
              return messages.next().then(processIteratorResult);
            }
            return messages.next().then(processIteratorResult);
          }
        })
        var sendClosure = (data, metadata, buffers, disposeOnDone) => {
          return comm_promise.then((comm) => {
            comm.send(data, metadata, buffers, disposeOnDone);
          });
        };
        var comm = {
          send: sendClosure
        };
      }
      window.PyViz.comms[comm_id] = comm;
      return comm;
    }
    window.PyViz.comm_manager = new JupyterCommManager();
    


var JS_MIME_TYPE = 'application/javascript';
var HTML_MIME_TYPE = 'text/html';
var EXEC_MIME_TYPE = 'application/vnd.holoviews_exec.v0+json';
var CLASS_NAME = 'output';

/**
 * Render data to the DOM node
 */
function render(props, node) {
  var div = document.createElement("div");
  var script = document.createElement("script");
  node.appendChild(div);
  node.appendChild(script);
}

/**
 * Handle when a new output is added
 */
function handle_add_output(event, handle) {
  var output_area = handle.output_area;
  var output = handle.output;
  if ((output.data == undefined) || (!output.data.hasOwnProperty(EXEC_MIME_TYPE))) {
    return
  }
  var id = output.metadata[EXEC_MIME_TYPE]["id"];
  var toinsert = output_area.element.find("." + CLASS_NAME.split(' ')[0]);
  if (id !== undefined) {
    var nchildren = toinsert.length;
    var html_node = toinsert[nchildren-1].children[0];
    html_node.innerHTML = output.data[HTML_MIME_TYPE];
    var scripts = [];
    var nodelist = html_node.querySelectorAll("script");
    for (var i in nodelist) {
      if (nodelist.hasOwnProperty(i)) {
        scripts.push(nodelist[i])
      }
    }

    scripts.forEach( function (oldScript) {
      var newScript = document.createElement("script");
      var attrs = [];
      var nodemap = oldScript.attributes;
      for (var j in nodemap) {
        if (nodemap.hasOwnProperty(j)) {
          attrs.push(nodemap[j])
        }
      }
      attrs.forEach(function(attr) { newScript.setAttribute(attr.name, attr.value) });
      newScript.appendChild(document.createTextNode(oldScript.innerHTML));
      oldScript.parentNode.replaceChild(newScript, oldScript);
    });
    if (JS_MIME_TYPE in output.data) {
      toinsert[nchildren-1].children[1].textContent = output.data[JS_MIME_TYPE];
    }
    output_area._hv_plot_id = id;
    if ((window.Bokeh !== undefined) && (id in Bokeh.index)) {
      window.PyViz.plot_index[id] = Bokeh.index[id];
    } else {
      window.PyViz.plot_index[id] = null;
    }
  } else if (output.metadata[EXEC_MIME_TYPE]["server_id"] !== undefined) {
    var bk_div = document.createElement("div");
    bk_div.innerHTML = output.data[HTML_MIME_TYPE];
    var script_attrs = bk_div.children[0].attributes;
    for (var i = 0; i < script_attrs.length; i++) {
      toinsert[toinsert.length - 1].childNodes[1].setAttribute(script_attrs[i].name, script_attrs[i].value);
    }
    // store reference to server id on output_area
    output_area._bokeh_server_id = output.metadata[EXEC_MIME_TYPE]["server_id"];
  }
}

/**
 * Handle when an output is cleared or removed
 */
function handle_clear_output(event, handle) {
  var id = handle.cell.output_area._hv_plot_id;
  var server_id = handle.cell.output_area._bokeh_server_id;
  if (((id === undefined) || !(id in PyViz.plot_index)) && (server_id !== undefined)) { return; }
  var comm = window.PyViz.comm_manager.get_client_comm("hv-extension-comm", "hv-extension-comm", function () {});
  if (server_id !== null) {
    comm.send({event_type: 'server_delete', 'id': server_id});
    return;
  } else if (comm !== null) {
    comm.send({event_type: 'delete', 'id': id});
  }
  delete PyViz.plot_index[id];
  if ((window.Bokeh !== undefined) & (id in window.Bokeh.index)) {
    var doc = window.Bokeh.index[id].model.document
    doc.clear();
    const i = window.Bokeh.documents.indexOf(doc);
    if (i > -1) {
      window.Bokeh.documents.splice(i, 1);
    }
  }
}

/**
 * Handle kernel restart event
 */
function handle_kernel_cleanup(event, handle) {
  delete PyViz.comms["hv-extension-comm"];
  window.PyViz.plot_index = {}
}

/**
 * Handle update_display_data messages
 */
function handle_update_output(event, handle) {
  handle_clear_output(event, {cell: {output_area: handle.output_area}})
  handle_add_output(event, handle)
}

function register_renderer(events, OutputArea) {
  function append_mime(data, metadata, element) {
    // create a DOM node to render to
    var toinsert = this.create_output_subarea(
    metadata,
    CLASS_NAME,
    EXEC_MIME_TYPE
    );
    this.keyboard_manager.register_events(toinsert);
    // Render to node
    var props = {data: data, metadata: metadata[EXEC_MIME_TYPE]};
    render(props, toinsert[0]);
    element.append(toinsert);
    return toinsert
  }

  events.on('output_added.OutputArea', handle_add_output);
  events.on('output_updated.OutputArea', handle_update_output);
  events.on('clear_output.CodeCell', handle_clear_output);
  events.on('delete.Cell', handle_clear_output);
  events.on('kernel_ready.Kernel', handle_kernel_cleanup);

  OutputArea.prototype.register_mime_type(EXEC_MIME_TYPE, append_mime, {
    safe: true,
    index: 0
  });
}

if (window.Jupyter !== undefined) {
  try {
    var events = require('base/js/events');
    var OutputArea = require('notebook/js/outputarea').OutputArea;
    if (OutputArea.prototype.mime_types().indexOf(EXEC_MIME_TYPE) == -1) {
      register_renderer(events, OutputArea);
    }
  } catch(err) {
  }
}
</script><div class="output text_html"><div id='c84d3918-5729-4930-80a3-08363c75d932'>
  <div id="c846647c-450b-4a9a-b892-a9b776f5ad21" data-root-id="c84d3918-5729-4930-80a3-08363c75d932" style="display: contents;"></div>
</div>
<script type="application/javascript">(function(root) {
  var docs_json = {"36e71d68-8be9-41b3-9093-ae37bdd1e551":{"version":"3.6.2","title":"Bokeh Application","roots":[{"type":"object","name":"panel.models.browser.BrowserInfo","id":"c84d3918-5729-4930-80a3-08363c75d932"},{"type":"object","name":"panel.models.comm_manager.CommManager","id":"929ad59a-4c95-4875-831d-418d9e2b6f53","attributes":{"plot_id":"c84d3918-5729-4930-80a3-08363c75d932","comm_id":"73e7e7bd57e04b53b3160cd7e93b51ee","client_comm_id":"3f18e25471fa499fa2c14854e4135c51"}}],"defs":[{"type":"model","name":"ReactiveHTML1"},{"type":"model","name":"FlexBox1","properties":[{"name":"align_content","kind":"Any","default":"flex-start"},{"name":"align_items","kind":"Any","default":"flex-start"},{"name":"flex_direction","kind":"Any","default":"row"},{"name":"flex_wrap","kind":"Any","default":"wrap"},{"name":"gap","kind":"Any","default":""},{"name":"justify_content","kind":"Any","default":"flex-start"}]},{"type":"model","name":"FloatPanel1","properties":[{"name":"config","kind":"Any","default":{"type":"map"}},{"name":"contained","kind":"Any","default":true},{"name":"position","kind":"Any","default":"right-top"},{"name":"offsetx","kind":"Any","default":null},{"name":"offsety","kind":"Any","default":null},{"name":"theme","kind":"Any","default":"primary"},{"name":"status","kind":"Any","default":"normalized"}]},{"type":"model","name":"GridStack1","properties":[{"name":"mode","kind":"Any","default":"warn"},{"name":"ncols","kind":"Any","default":null},{"name":"nrows","kind":"Any","default":null},{"name":"allow_resize","kind":"Any","default":true},{"name":"allow_drag","kind":"Any","default":true},{"name":"state","kind":"Any","default":[]}]},{"type":"model","name":"drag1","properties":[{"name":"slider_width","kind":"Any","default":5},{"name":"slider_color","kind":"Any","default":"black"},{"name":"value","kind":"Any","default":50}]},{"type":"model","name":"click1","properties":[{"name":"terminal_output","kind":"Any","default":""},{"name":"debug_name","kind":"Any","default":""},{"name":"clears","kind":"Any","default":0}]},{"type":"model","name":"FastWrapper1","properties":[{"name":"object","kind":"Any","default":null},{"name":"style","kind":"Any","default":null}]},{"type":"model","name":"NotificationAreaBase1","properties":[{"name":"js_events","kind":"Any","default":{"type":"map"}},{"name":"position","kind":"Any","default":"bottom-right"},{"name":"_clear","kind":"Any","default":0}]},{"type":"model","name":"NotificationArea1","properties":[{"name":"js_events","kind":"Any","default":{"type":"map"}},{"name":"notifications","kind":"Any","default":[]},{"name":"position","kind":"Any","default":"bottom-right"},{"name":"_clear","kind":"Any","default":0},{"name":"types","kind":"Any","default":[{"type":"map","entries":[["type","warning"],["background","#ffc107"],["icon",{"type":"map","entries":[["className","fas fa-exclamation-triangle"],["tagName","i"],["color","white"]]}]]},{"type":"map","entries":[["type","info"],["background","#007bff"],["icon",{"type":"map","entries":[["className","fas fa-info-circle"],["tagName","i"],["color","white"]]}]]}]}]},{"type":"model","name":"Notification","properties":[{"name":"background","kind":"Any","default":null},{"name":"duration","kind":"Any","default":3000},{"name":"icon","kind":"Any","default":null},{"name":"message","kind":"Any","default":""},{"name":"notification_type","kind":"Any","default":null},{"name":"_rendered","kind":"Any","default":false},{"name":"_destroyed","kind":"Any","default":false}]},{"type":"model","name":"TemplateActions1","properties":[{"name":"open_modal","kind":"Any","default":0},{"name":"close_modal","kind":"Any","default":0}]},{"type":"model","name":"BootstrapTemplateActions1","properties":[{"name":"open_modal","kind":"Any","default":0},{"name":"close_modal","kind":"Any","default":0}]},{"type":"model","name":"TemplateEditor1","properties":[{"name":"layout","kind":"Any","default":[]}]},{"type":"model","name":"MaterialTemplateActions1","properties":[{"name":"open_modal","kind":"Any","default":0},{"name":"close_modal","kind":"Any","default":0}]},{"type":"model","name":"ReactiveESM1","properties":[{"name":"esm_constants","kind":"Any","default":{"type":"map"}}]},{"type":"model","name":"JSComponent1","properties":[{"name":"esm_constants","kind":"Any","default":{"type":"map"}}]},{"type":"model","name":"ReactComponent1","properties":[{"name":"esm_constants","kind":"Any","default":{"type":"map"}}]},{"type":"model","name":"AnyWidgetComponent1","properties":[{"name":"esm_constants","kind":"Any","default":{"type":"map"}}]},{"type":"model","name":"request_value1","properties":[{"name":"fill","kind":"Any","default":"none"},{"name":"_synced","kind":"Any","default":null},{"name":"_request_sync","kind":"Any","default":0}]}]}};
  var render_items = [{"docid":"36e71d68-8be9-41b3-9093-ae37bdd1e551","roots":{"c84d3918-5729-4930-80a3-08363c75d932":"c846647c-450b-4a9a-b892-a9b776f5ad21"},"root_ids":["c84d3918-5729-4930-80a3-08363c75d932"]}];
  var docs = Object.values(docs_json)
  if (!docs) {
    return
  }
  const py_version = docs[0].version.replace('rc', '-rc.').replace('.dev', '-dev.')
  async function embed_document(root) {
    var Bokeh = get_bokeh(root)
    await Bokeh.embed.embed_items_notebook(docs_json, render_items);
    for (const render_item of render_items) {
      for (const root_id of render_item.root_ids) {
	const id_el = document.getElementById(root_id)
	if (id_el.children.length && id_el.children[0].hasAttribute('data-root-id')) {
	  const root_el = id_el.children[0]
	  root_el.id = root_el.id + '-rendered'
	  for (const child of root_el.children) {
            // Ensure JupyterLab does not capture keyboard shortcuts
            // see: https://jupyterlab.readthedocs.io/en/4.1.x/extension/notebook.html#keyboard-interaction-model
	    child.setAttribute('data-lm-suppress-shortcuts', 'true')
	  }
	}
      }
    }
  }
  function get_bokeh(root) {
    if (root.Bokeh === undefined) {
      return null
    } else if (root.Bokeh.version !== py_version) {
      if (root.Bokeh.versions === undefined || !root.Bokeh.versions.has(py_version)) {
	return null
      }
      return root.Bokeh.versions.get(py_version);
    } else if (root.Bokeh.version === py_version) {
      return root.Bokeh
    }
    return null
  }
  function is_loaded(root) {
    var Bokeh = get_bokeh(root)
    return (Bokeh != null && Bokeh.Panel !== undefined)
  }
  if (is_loaded(root)) {
    embed_document(root);
  } else {
    var attempts = 0;
    var timer = setInterval(function(root) {
      if (is_loaded(root)) {
        clearInterval(timer);
        embed_document(root);
      } else if (document.readyState == "complete") {
        attempts++;
        if (attempts > 200) {
          clearInterval(timer);
	  var Bokeh = get_bokeh(root)
	  if (Bokeh == null || Bokeh.Panel == null) {
            console.warn("Panel: ERROR: Unable to run Panel code because Bokeh or Panel library is missing");
	  } else {
	    console.warn("Panel: WARNING: Attempting to render but not all required libraries could be resolved.")
	    embed_document(root)
	  }
        }
      }
    }, 25, root)
  }
})(window);</script></div><img alt="../../_images/769b41be17b52706e8d2347f927d07fe10fbe747f2ce7338f96204bdb2d89f0d.png" src="../../_images/769b41be17b52706e8d2347f927d07fe10fbe747f2ce7338f96204bdb2d89f0d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dists</span> <span class="o">=</span> <span class="n">euclidean_distances</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dists</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.00</td>
      <td>2.97</td>
      <td>8.73</td>
      <td>6.83</td>
      <td>1.68</td>
      <td>7.95</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2.97</td>
      <td>0.00</td>
      <td>11.70</td>
      <td>9.80</td>
      <td>4.25</td>
      <td>10.92</td>
    </tr>
    <tr>
      <th>2</th>
      <td>8.73</td>
      <td>11.70</td>
      <td>0.00</td>
      <td>1.90</td>
      <td>7.77</td>
      <td>0.82</td>
    </tr>
    <tr>
      <th>3</th>
      <td>6.83</td>
      <td>9.80</td>
      <td>1.90</td>
      <td>0.00</td>
      <td>5.89</td>
      <td>1.14</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.68</td>
      <td>4.25</td>
      <td>7.77</td>
      <td>5.89</td>
      <td>0.00</td>
      <td>6.95</td>
    </tr>
    <tr>
      <th>5</th>
      <td>7.95</td>
      <td>10.92</td>
      <td>0.82</td>
      <td>1.14</td>
      <td>6.95</td>
      <td>0.00</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dists</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">dists</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">dists</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(np.float64(0.0),
 np.float64(11.699901396097971),
 np.float64(4.961109802000134))
</pre></div>
</div>
</div>
</div>
<p><strong>Effect of <code class="docutils literal notranslate"><span class="pre">min_samples</span></code> hyperparameter</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">min_samples</span><span class="p">):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">plot_dbscan_with_labels</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">min_samples</span><span class="o">=</span><span class="n">min_samples</span><span class="p">)</span>

<span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/cbe7436678e7fa605df2b3392f5004aaafdc8983b7567c47b927a7dcd20740b2.png" src="../../_images/cbe7436678e7fa605df2b3392f5004aaafdc8983b7567c47b927a7dcd20740b2.png" />
</div>
</div>
</section>
<section id="more-details-on-dbscan">
<h3>More details on DBSCAN<a class="headerlink" href="#more-details-on-dbscan" title="Link to this heading">#</a></h3>
<p><strong>Illustration of hyperparameters <code class="docutils literal notranslate"><span class="pre">eps</span></code> and <code class="docutils literal notranslate"><span class="pre">min_samples</span></code></strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_blobs</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">discrete_scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/05bdba038ad5b01082e425aae573caf3c488da19f12087ce59abe5785bad66cc.png" src="../../_images/05bdba038ad5b01082e425aae573caf3c488da19f12087ce59abe5785bad66cc.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dbscan</span> <span class="o">=</span> <span class="n">DBSCAN</span><span class="p">()</span>
<span class="n">clusters</span> <span class="o">=</span> <span class="n">dbscan</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cluster memberships:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">clusters</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Cluster memberships:[-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1]
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Default values for hyperparameters don’t work well on toy datasets.</p></li>
<li><p>All points have been marked as noise with the default values for <code class="docutils literal notranslate"><span class="pre">eps</span></code> and <code class="docutils literal notranslate"><span class="pre">min_samples</span></code></p></li>
<li><p>Let’s examine the effect of changing these hyperparameters.</p>
<ul>
<li><p>noise points: shown in white</p></li>
<li><p>core points: bigger</p></li>
<li><p>border points: smaller</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_dbscan</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>min_samples: 2 eps: 1.000000  cluster: [-1  0  0 -1  0 -1  1  1  0  1 -1 -1]
min_samples: 2 eps: 1.500000  cluster: [0 1 1 1 1 0 2 2 1 2 2 0]
min_samples: 2 eps: 2.000000  cluster: [0 1 1 1 1 0 0 0 1 0 0 0]
min_samples: 2 eps: 3.000000  cluster: [0 0 0 0 0 0 0 0 0 0 0 0]
min_samples: 3 eps: 1.000000  cluster: [-1  0  0 -1  0 -1  1  1  0  1 -1 -1]
min_samples: 3 eps: 1.500000  cluster: [0 1 1 1 1 0 2 2 1 2 2 0]
min_samples: 3 eps: 2.000000  cluster: [0 1 1 1 1 0 0 0 1 0 0 0]
min_samples: 3 eps: 3.000000  cluster: [0 0 0 0 0 0 0 0 0 0 0 0]
min_samples: 5 eps: 1.000000  cluster: [-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1]
min_samples: 5 eps: 1.500000  cluster: [-1  0  0  0  0 -1 -1 -1  0 -1 -1 -1]
min_samples: 5 eps: 2.000000  cluster: [-1  0  0  0  0 -1 -1 -1  0 -1 -1 -1]
min_samples: 5 eps: 3.000000  cluster: [0 0 0 0 0 0 0 0 0 0 0 0]
</pre></div>
</div>
<img alt="../../_images/b9843dd8bf12170c3134abd17b93f4dc8beffb890525a8df2c8475c3781e39e7.png" src="../../_images/b9843dd8bf12170c3134abd17b93f4dc8beffb890525a8df2c8475c3781e39e7.png" />
</div>
</div>
<p><strong>Observations</strong></p>
<ul class="simple">
<li><p>Increasing <code class="docutils literal notranslate"><span class="pre">eps</span></code> (<span class="math notranslate nohighlight">\(\uparrow\)</span>) (left to right in the plot above) means more points will be included in a cluster.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">eps</span></code> = 1.0 either creates more clusters or more noise points, whereas eps=3.0 puts all points in one cluster with no noise points.</p></li>
</ul>
</li>
<li><p>Increasing <code class="docutils literal notranslate"><span class="pre">min_samples</span></code> (<span class="math notranslate nohighlight">\(\uparrow\)</span>) (top to bottom in the plot above) means points in less dense regions will either be labeled as their own cluster or noise.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">min_samples=2</span></code>, for instance, has none or only a fewer noise points whereas <code class="docutils literal notranslate"><span class="pre">min_samples=5</span></code> has several noise points.</p></li>
</ul>
</li>
<li><p>Here <code class="docutils literal notranslate"><span class="pre">min_samples</span></code> = 2.0 or 3.0 and <code class="docutils literal notranslate"><span class="pre">eps</span></code> = 1.5 is giving us the best results.</p></li>
<li><p>In general, it’s not trivial to tune these hyperparameters.</p></li>
</ul>
<p><strong>K-Means vs. DBSCAN</strong></p>
<ul class="simple">
<li><p>In DBSCAN, you do not have to specify the number of clusters!</p>
<ul>
<li><p>Instead, you have to tune <code class="docutils literal notranslate"><span class="pre">eps</span></code> and <code class="docutils literal notranslate"><span class="pre">min_samples</span></code>.</p></li>
</ul>
</li>
<li><p>Unlike K-Means, DBSCAN doesn’t have to assign all points to clusters.</p>
<ul>
<li><p>The label is -1 if a point is unassigned.</p></li>
</ul>
</li>
<li><p>Unlike K-Means, there is no <code class="docutils literal notranslate"><span class="pre">predict</span></code> method.</p>
<ul>
<li><p>DBSCAN only really clusters the points you have, not “new” or “test” points.</p></li>
</ul>
</li>
</ul>
</section>
<section id="question-for-you">
<h3>Question for you<a class="headerlink" href="#question-for-you" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Does the order that you pick the points matter in DBSCAN?
<br><br><br><br></p></li>
</ul>
<blockquote>
<div><p>No. Any of the cluster’s core points is able to fully identify the cluster, with no randomness involved. The only possible conflict you might get is that if two clusters have the same border point. In this case the assignment will be implementation dependent, but usually the border point will be assigned to the first cluster that “finds” it.</p>
</div></blockquote>
</section>
<section id="evaluating-dbscan-clusters">
<h3>Evaluating DBSCAN clusters<a class="headerlink" href="#evaluating-dbscan-clusters" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>We cannot use the elbow method to examine the goodness of clusters created with DBSCAN.</p></li>
<li><p>But we can use the silhouette method because it’s not dependent on the idea of cluster centers.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_blobs</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">centers</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="n">dbscan</span> <span class="o">=</span> <span class="n">DBSCAN</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_samples</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">dbscan</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">plot_original_clustered</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">dbscan</span><span class="p">,</span> <span class="n">dbscan</span><span class="o">.</span><span class="n">labels_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/9a7c01b3b2b0b475e0dac2622639cc8d2658ed3fe70dbdbc7c3b2ace2f1ca1cd.png" src="../../_images/9a7c01b3b2b0b475e0dac2622639cc8d2658ed3fe70dbdbc7c3b2ace2f1ca1cd.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Yellowbrick is designed to work with K-Means and not with DBSCAN.</span>
<span class="c1"># So it needs the number of clusters stored in n_clusters</span>
<span class="c1"># It also needs `predict` method to be implemented.</span>
<span class="c1"># So I&#39;m implementing it here so that we can use Yellowbrick to show Silhouette plots.</span>
<span class="n">n_clusters</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">dbscan</span><span class="o">.</span><span class="n">labels_</span><span class="p">))</span>
<span class="n">dbscan</span><span class="o">.</span><span class="n">n_clusters</span> <span class="o">=</span> <span class="n">n_clusters</span>
<span class="n">dbscan</span><span class="o">.</span><span class="n">predict</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">dbscan</span><span class="o">.</span><span class="n">labels_</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visualizer</span> <span class="o">=</span> <span class="n">SilhouetteVisualizer</span><span class="p">(</span><span class="n">dbscan</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s2">&quot;yellowbrick&quot;</span><span class="p">)</span>
<span class="n">visualizer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>  <span class="c1"># Fit the data to the visualizer</span>
<span class="n">visualizer</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/301f1049e5c140351c055932f4e733d28736930eb0e381f3987b3cdcf15a148f.png" src="../../_images/301f1049e5c140351c055932f4e733d28736930eb0e381f3987b3cdcf15a148f.png" />
</div>
</div>
</section>
<section id="summary-pros-and-cons">
<h3>Summary: Pros and cons<a class="headerlink" href="#summary-pros-and-cons" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Pros</p>
<ul>
<li><p>Can learn arbitrary cluster shapes</p></li>
<li><p>Can detect outliers</p></li>
</ul>
</li>
<li><p>Cons</p>
<ul>
<li><p>Cannot <code class="docutils literal notranslate"><span class="pre">predict</span></code> on new examples.</p></li>
<li><p>Needs tuning of two non-obvious hyperparameters</p></li>
</ul>
</li>
</ul>
<p>There is an improved version of DBSCAN called <a class="reference external" href="https://github.com/scikit-learn-contrib/hdbscan"><code class="docutils literal notranslate"><span class="pre">HDBSCAN</span></code> (hierarchical DBSCAN)</a>.</p>
</section>
<section id="dbscan-failure-cases">
<h3>DBSCAN: failure cases<a class="headerlink" href="#dbscan-failure-cases" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>DBSCAN is able to capture complex clusters. But this doesn’t mean that <code class="docutils literal notranslate"><span class="pre">DBSCAN</span></code> always works better. It has its own problems!</p></li>
<li><p>DBSCAN doesn’t do well when we have clusters with different densities.</p>
<ul>
<li><p>You can play with the hyperparameters but it’s not likely to help much.</p></li>
</ul>
</li>
</ul>
</section>
<section id="id1">
<h3>DBSCAN: failure cases<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Let’s consider this dataset with three clusters of varying densities.</p></li>
<li><p>K-Means performs better compared to DBSCAN. But it has the benefit of knowing the value of <span class="math notranslate nohighlight">\(K\)</span> in advance.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_varied</span><span class="p">,</span> <span class="n">y_varied</span> <span class="o">=</span> <span class="n">make_blobs</span><span class="p">(</span>
    <span class="n">n_samples</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">cluster_std</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>
<span class="n">plot_k_means_dbscan_comparison</span><span class="p">(</span><span class="n">X_varied</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15]
</pre></div>
</div>
<img alt="../../_images/fe4b58491b566aca914a96b21c8e78c4eda4c8ba65f98453a5f75cb350d68b3e.png" src="../../_images/fe4b58491b566aca914a96b21c8e78c4eda4c8ba65f98453a5f75cb350d68b3e.png" />
</div>
</div>
</section>
</section>
<section id="questions-for-you">
<h2>❓❓ Questions for you<a class="headerlink" href="#questions-for-you" title="Link to this heading">#</a></h2>
<section id="id2">
<h3>16.2 Select all of the following statements which are <strong>True</strong> https://join.iclicker.com/FUYI<a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>(A) With tiny epsilon (<code class="docutils literal notranslate"><span class="pre">eps</span></code> in <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>) and min samples=1 (<code class="docutils literal notranslate"><span class="pre">min_samples=1</span></code> in <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>) we are likely to end up with each point in its own cluster.</p></li>
<li><p>(B) With a smaller value of <code class="docutils literal notranslate"><span class="pre">eps</span></code> and larger number for <code class="docutils literal notranslate"><span class="pre">min_samples</span></code> we are likely to end up with a one big cluster.</p></li>
<li><p>(C) K-Means is more susceptible to outliers compared to DBSCAN.</p></li>
<li><p>(D) In DBSCAN to be part of a cluster, each point must have at least <code class="docutils literal notranslate"><span class="pre">min_samples</span></code> neighbours in a given radius (including itself).</p></li>
</ul>
<p><br><br><br><br></p>
</section>
</section>
<section id="hierarchical-clustering-video">
<h2>Hierarchical clustering [<a class="reference external" href="https://www.youtube.com/watch?v=NM8lFKFZ2IU">video</a>]<a class="headerlink" href="#hierarchical-clustering-video" title="Link to this heading">#</a></h2>
<section id="introduction">
<h3>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Deciding how many clusters we want is a hard problem.</p></li>
<li><p>Often, it’s useful to get a complete picture of similarity between points in our data before picking the number of clusters.</p></li>
<li><p>Hierarchical clustering is helpful in these scenarios.</p></li>
</ul>
<p><strong>Main idea</strong></p>
<ol class="arabic simple">
<li><p>Start with each point in its own cluster.</p></li>
<li><p>Greedily merge most similar <em>clusters</em>.</p></li>
<li><p>Repeat Step 2 until you obtain only one cluster (<span class="math notranslate nohighlight">\(n-1\)</span> times).</p></li>
</ol>
<ul class="simple">
<li><p>Hierarchical clustering can be visualized using a tool called <strong>a dendrogram</strong>.</p></li>
<li><p>Unfortunately, <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> cannot do it so we will use the package <code class="docutils literal notranslate"><span class="pre">scipy.cluster.hierarchy</span></code> for hierarchical clustering. Let’s try it out before understanding how it works.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.cluster.hierarchy</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">average</span><span class="p">,</span>
    <span class="n">complete</span><span class="p">,</span>
    <span class="n">dendrogram</span><span class="p">,</span>
    <span class="n">fcluster</span><span class="p">,</span>
    <span class="n">single</span><span class="p">,</span>
    <span class="n">ward</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">X_orig</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_blobs</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_orig</span><span class="p">)</span>
<span class="n">linkage_array</span> <span class="o">=</span> <span class="n">ward</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_X_dendrogram</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">linkage_array</span><span class="p">,</span> <span class="n">label_n_clusters</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># user-defined function defined in code/plotting_functions.py</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/8e3a1dac56dceb92f85ce04618620ce0a56397381163a48bd1c5020ebd57de88.png" src="../../_images/8e3a1dac56dceb92f85ce04618620ce0a56397381163a48bd1c5020ebd57de88.png" />
</div>
</div>
<ul class="simple">
<li><p>Every point goes through the journey of being on its own (its own cluster) and getting merged with some other bigger clusters.</p></li>
<li><p>The intermediate steps in the process provide us clustering with different number of clusters.</p></li>
</ul>
</section>
<section id="dendrogram">
<h3>Dendrogram<a class="headerlink" href="#dendrogram" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Dendrogram is a tree-like plot.</p></li>
<li><p>On the x-axis we have data points.</p></li>
<li><p>On the y-axis we have distances between clusters.</p></li>
<li><p>We start with data points as leaves of the tree.</p></li>
<li><p>New parent node is created for every two clusters that are joined.</p></li>
<li><p>The length of each branch shows how far the merged clusters go.</p>
<ul>
<li><p>In the dendrogram above going from three clusters to two clusters means merging far apart points because the branches between three cluster to two clusters are long.</p></li>
</ul>
</li>
</ul>
<p><strong>How to plot a dendrogram?</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.cluster.hierarchy</span><span class="w"> </span><span class="kn">import</span> <span class="n">dendrogram</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">dendrogram</span><span class="p">(</span><span class="n">linkage_array</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color_threshold</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Sample index&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cluster distance&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/067f05a224cf6dfb09b7a10522d3500d1881bd1d2908f81727353e2a4ac2fbd4.png" src="../../_images/067f05a224cf6dfb09b7a10522d3500d1881bd1d2908f81727353e2a4ac2fbd4.png" />
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The colours you see above are based on the <code class="docutils literal notranslate"><span class="pre">color_threshold</span></code> parameter. It colours all the descendent links below a cluster node <span class="math notranslate nohighlight">\(k\)</span> the same color if <span class="math notranslate nohighlight">\(k\)</span> is the first node below the cut threshold.</p>
</div>
<p><strong>Flat clusters</strong></p>
<ul class="simple">
<li><p>This is good but how can we get cluster labels from a dendrogram?</p></li>
<li><p>We can bring the clustering to a “flat” format using <code class="docutils literal notranslate"><span class="pre">fcluster</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.cluster.hierarchy</span><span class="w"> </span><span class="kn">import</span> <span class="n">fcluster</span>

<span class="c1"># flattening the dendrogram based on maximum number of clusters. </span>
<span class="n">hier_labels1</span> <span class="o">=</span> <span class="n">fcluster</span><span class="p">(</span><span class="n">linkage_array</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="s2">&quot;maxclust&quot;</span><span class="p">)</span> 
<span class="n">hier_labels1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([2, 1, 2, 3, 2, 3, 3, 2, 1, 3, 1], dtype=int32)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_dendrogram_clusters</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">linkage_array</span><span class="p">,</span> <span class="n">hier_labels1</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;flattened with max_clusts=3&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/7d07bf5c897051f2c2aee701a3c09444f85f61765af4fae12d9e2d58bd5afbdf.png" src="../../_images/7d07bf5c897051f2c2aee701a3c09444f85f61765af4fae12d9e2d58bd5afbdf.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># flattening the dendrogram based on maximum distance between points. </span>
<span class="n">hier_labels2</span> <span class="o">=</span> <span class="n">fcluster</span><span class="p">(</span><span class="n">linkage_array</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="s2">&quot;distance&quot;</span><span class="p">)</span> 
<span class="n">hier_labels2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([3, 2, 3, 6, 4, 5, 7, 4, 1, 5, 1], dtype=int32)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_dendrogram_clusters</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">linkage_array</span><span class="p">,</span> <span class="n">hier_labels2</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;flattened with dist=0.7&quot;</span><span class="p">,</span> <span class="n">color_threshold</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/132e74fe68281967e3aa626eddcc86d85f25fdb4cf16e2c580742dd0bf30d9c1.png" src="../../_images/132e74fe68281967e3aa626eddcc86d85f25fdb4cf16e2c580742dd0bf30d9c1.png" />
</div>
</div>
<p>When we create a dendrogram, we need to calculate distance between clusters.</p>
<ul class="simple">
<li><p>We know how to measure distance between points (e.g., using Euclidean distance).</p></li>
<li><p>How do we measure distances between clusters?</p></li>
<li><p>The <strong>linkage criteria</strong> determines how to find similarity between clusters:</p></li>
<li><p>Some example linkage criteria are:</p>
<ul>
<li><p>Single linkage <span class="math notranslate nohighlight">\(\rightarrow\)</span> smallest minimal distance, leads to loose clusters</p></li>
<li><p>Complete linkage <span class="math notranslate nohighlight">\(\rightarrow\)</span> smallest maximum distance, leads to tight clusters</p></li>
<li><p>Average linkage <span class="math notranslate nohighlight">\(\rightarrow\)</span> smallest average distance between all pairs of points in the clusters</p></li>
<li><p>Ward linkage <span class="math notranslate nohighlight">\(\rightarrow\)</span> smallest increase in within-cluster variance, leads to equally sized clusters</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_X_dendrogram</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">linkage_array</span><span class="p">,</span> <span class="n">label_n_clusters</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/8e3a1dac56dceb92f85ce04618620ce0a56397381163a48bd1c5020ebd57de88.png" src="../../_images/8e3a1dac56dceb92f85ce04618620ce0a56397381163a48bd1c5020ebd57de88.png" />
</div>
</div>
<p><strong><code class="docutils literal notranslate"><span class="pre">single</span></code> linkage</strong></p>
<ul class="simple">
<li><p>Merges two clusters that have the smallest minimum distance between all their points.</p></li>
<li><p>Let’s use <code class="docutils literal notranslate"><span class="pre">scipy.cluster.hierarchy</span></code>’s <code class="docutils literal notranslate"><span class="pre">single</span></code> to get linkage information.</p></li>
<li><p>This method gives us matrix <code class="docutils literal notranslate"><span class="pre">Z</span></code> with the merging information.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Z</span> <span class="o">=</span> <span class="n">single</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;c1&quot;</span><span class="p">,</span> <span class="s2">&quot;c2&quot;</span><span class="p">,</span> <span class="s2">&quot;distance(c1, c2)&quot;</span><span class="p">,</span> <span class="s2">&quot;# observations&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>c1</th>
      <th>c2</th>
      <th>distance(c1, c2)</th>
      <th># observations</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>2.0</td>
      <td>0.201332</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5.0</td>
      <td>9.0</td>
      <td>0.368922</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4.0</td>
      <td>7.0</td>
      <td>0.610931</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>11.0</td>
      <td>13.0</td>
      <td>0.617431</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3.0</td>
      <td>12.0</td>
      <td>0.644770</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>The linkage returns a matrix <code class="docutils literal notranslate"><span class="pre">Z</span></code> of shape n-1 by 4:</p></li>
<li><p>The rows represent iterations.</p></li>
<li><p>First and second columns (c1 and c2 above): indexes of the clusters being merged.</p></li>
<li><p>Third column (distance(c1, c2)): the distance between the clusters being merged.</p></li>
<li><p>Fourth column (# observations): the number of examples in the newly formed cluster.</p></li>
</ul>
<p><strong>Creating dendrogram with <code class="docutils literal notranslate"><span class="pre">single</span></code> linkage</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">linkage_array</span> <span class="o">=</span> <span class="n">single</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">hier_labels</span> <span class="o">=</span> <span class="n">fcluster</span><span class="p">(</span><span class="n">linkage_array</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="s2">&quot;maxclust&quot;</span><span class="p">)</span> 
<span class="n">plot_dendrogram_clusters</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">linkage_array</span><span class="p">,</span> <span class="n">hier_labels</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;maxclust 3&quot;</span><span class="p">,</span> <span class="n">color_threshold</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/d651f4367684d8810d7d3a7470fe2cd2011ab0cd731419a1d197f878f68ec9fa.png" src="../../_images/d651f4367684d8810d7d3a7470fe2cd2011ab0cd731419a1d197f878f68ec9fa.png" />
</div>
</div>
<p>Suppose we decide to go from 3 clusters to 2 clusters. Which clusters would be merged with single linkage criterion? It will merge the clusters with the smallest minimal distance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hier_labels</span> <span class="o">=</span> <span class="n">fcluster</span><span class="p">(</span><span class="n">linkage_array</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="s2">&quot;maxclust&quot;</span><span class="p">)</span> 
<span class="n">plot_dendrogram_clusters</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">linkage_array</span><span class="p">,</span> <span class="n">hier_labels</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;maxclust 2&quot;</span><span class="p">,</span> <span class="n">color_threshold</span><span class="o">=</span><span class="mf">1.4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/775b515c436c3967adf80b693bcbbe088b61ecb8e27dff4dc9e63eca883dc728.png" src="../../_images/775b515c436c3967adf80b693bcbbe088b61ecb8e27dff4dc9e63eca883dc728.png" />
</div>
</div>
<p><strong><code class="docutils literal notranslate"><span class="pre">complete</span></code> linkage</strong></p>
<ul class="simple">
<li><p>Merges two clusters that have the smallest maximum distance between their points.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">linkage_array</span> <span class="o">=</span> <span class="n">complete</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">hier_labels</span> <span class="o">=</span> <span class="n">fcluster</span><span class="p">(</span><span class="n">linkage_array</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="s2">&quot;maxclust&quot;</span><span class="p">)</span> 
<span class="n">plot_dendrogram_clusters</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">linkage_array</span><span class="p">,</span> <span class="n">hier_labels</span><span class="p">,</span> <span class="n">linkage_type</span><span class="o">=</span><span class="s1">&#39;complete&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;maxclust 3&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/45a0dc9a9e80248268d412ef91cd282d67bdd4df4fdf6cee34ddf42bd50981c6.png" src="../../_images/45a0dc9a9e80248268d412ef91cd282d67bdd4df4fdf6cee34ddf42bd50981c6.png" />
</div>
</div>
<p>Suppose we decide to go from 3 clusters to 2 clusters. Which clusters would be merged with single linkage criterion? It will merge the clusters with the smallest maximum distance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hier_labels</span> <span class="o">=</span> <span class="n">fcluster</span><span class="p">(</span><span class="n">linkage_array</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="s2">&quot;maxclust&quot;</span><span class="p">)</span> 
<span class="n">plot_dendrogram_clusters</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">linkage_array</span><span class="p">,</span> <span class="n">hier_labels</span><span class="p">,</span> <span class="n">linkage_type</span><span class="o">=</span><span class="s1">&#39;complete&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;maxclust 2&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/4e6084ae1b0d28265e44bbb9a3b6732a838b2f5f2d2b35d37b6203d76ae608b4.png" src="../../_images/4e6084ae1b0d28265e44bbb9a3b6732a838b2f5f2d2b35d37b6203d76ae608b4.png" />
</div>
</div>
<p><strong><code class="docutils literal notranslate"><span class="pre">average</span></code> linkage</strong></p>
<ul class="simple">
<li><p>Merges two clusters that have the smallest average distance between all their points.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">linkage_array</span> <span class="o">=</span> <span class="n">average</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">hier_labels</span> <span class="o">=</span> <span class="n">fcluster</span><span class="p">(</span><span class="n">linkage_array</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="s2">&quot;maxclust&quot;</span><span class="p">)</span> 
<span class="n">plot_dendrogram_clusters</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">linkage_array</span><span class="p">,</span> <span class="n">hier_labels</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;maxclust 3&quot;</span><span class="p">,</span> <span class="n">color_threshold</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/279e52274f4e61c3d37f8586fc8fac05d9ce9e0fc8cce7e51c1b5dc616be886c.png" src="../../_images/279e52274f4e61c3d37f8586fc8fac05d9ce9e0fc8cce7e51c1b5dc616be886c.png" />
</div>
</div>
<p>Suppose we decide to go from 3 clusters to 2 clusters. Which clusters would be merged with single linkage criterion? It will merge the clusters with the smallest average distance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hier_labels</span> <span class="o">=</span> <span class="n">fcluster</span><span class="p">(</span><span class="n">linkage_array</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="s2">&quot;maxclust&quot;</span><span class="p">)</span> 
<span class="n">plot_dendrogram_clusters</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">linkage_array</span><span class="p">,</span> <span class="n">hier_labels</span><span class="p">,</span> <span class="n">linkage_type</span><span class="o">=</span><span class="s1">&#39;average&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;maxclust 2&quot;</span><span class="p">,</span> <span class="n">color_threshold</span><span class="o">=</span><span class="mf">2.25</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/f65f5e55fb5aed37901a4a6fb38da6c17e31a20bd21ec8f342c767aa8fc399d5.png" src="../../_images/f65f5e55fb5aed37901a4a6fb38da6c17e31a20bd21ec8f342c767aa8fc399d5.png" />
</div>
</div>
<p><strong><code class="docutils literal notranslate"><span class="pre">ward</span></code> linkage</strong></p>
<ul class="simple">
<li><p>Picks two clusters to merge such that the variance within all clusters increases the least.</p></li>
<li><p>Often leads to equally sized clusters.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">linkage_array</span> <span class="o">=</span> <span class="n">ward</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">hier_labels</span> <span class="o">=</span> <span class="n">fcluster</span><span class="p">(</span><span class="n">linkage_array</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="s2">&quot;maxclust&quot;</span><span class="p">)</span> 
<span class="n">plot_dendrogram_clusters</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">linkage_array</span><span class="p">,</span> <span class="n">hier_labels</span><span class="p">,</span> <span class="n">linkage_type</span><span class="o">=</span><span class="s1">&#39;ward&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;maxclust 3&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/fcbd009b53c4603031c1fbb5aefe21acc7ed36a26f457fe305af13b13e55ee94.png" src="../../_images/fcbd009b53c4603031c1fbb5aefe21acc7ed36a26f457fe305af13b13e55ee94.png" />
</div>
</div>
<p>Suppose we decide to go from 3 clusters to 2 clusters. Which clusters would be merged with ward linkage criterion? It will merge the clusters with the smallest within-cluster variance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hier_labels</span> <span class="o">=</span> <span class="n">fcluster</span><span class="p">(</span><span class="n">linkage_array</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="s2">&quot;maxclust&quot;</span><span class="p">)</span> 
<span class="n">plot_dendrogram_clusters</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">linkage_array</span><span class="p">,</span> <span class="n">hier_labels</span><span class="p">,</span> <span class="n">linkage_type</span><span class="o">=</span><span class="s1">&#39;ward&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;maxclust 2&quot;</span><span class="p">,</span> <span class="n">color_threshold</span><span class="o">=</span><span class="mf">4.3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/1ac62c9d69138a969e609fe7a41b243d2d8e2c0c8bde27cb20bc8fd7bebf4d16.png" src="../../_images/1ac62c9d69138a969e609fe7a41b243d2d8e2c0c8bde27cb20bc8fd7bebf4d16.png" />
</div>
</div>
<p>Different type of linkage criterion can be appropriate in different scenarios and the goals of clustering analysis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.datasets</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_blobs</span>
<span class="n">X2</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_blobs</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">centers</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">X2</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="c1"># Add some noise to the dataset</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_linkage_criteria</span><span class="p">(</span><span class="n">X2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/5b76b849706a3d84983d34fe074330885f64ae3335a6c60d06c455ed35f9c8b8.png" src="../../_images/5b76b849706a3d84983d34fe074330885f64ae3335a6c60d06c455ed35f9c8b8.png" />
</div>
</div>
<ul class="simple">
<li><p>Single linkage <span class="math notranslate nohighlight">\(\rightarrow\)</span> smallest minimal distance, leads to loose clusters</p></li>
<li><p>Complete linkage <span class="math notranslate nohighlight">\(\rightarrow\)</span> smallest maximum distance, leads to tight clusters</p></li>
<li><p>Average linkage <span class="math notranslate nohighlight">\(\rightarrow\)</span> smallest average distance between all pairs of points in the clusters</p></li>
<li><p>Ward linkage <span class="math notranslate nohighlight">\(\rightarrow\)</span> smallest increase in within-cluster variance, leads to equally sized clusters</p></li>
</ul>
<p><strong>Truncation</strong></p>
<p>This is a toy dataset and it’s possible to view all the leaves. But what if we have thousands of examples, which is common in real-world datasets? We can use truncation. There are two levels of truncation supported in <code class="docutils literal notranslate"><span class="pre">scipy.cluster.hierarchy</span></code>.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">level</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> Maximum depth of the tree is <span class="math notranslate nohighlight">\(p\)</span></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lastp</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> Only <span class="math notranslate nohighlight">\(p\)</span> leaves are shown</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Z</span> <span class="o">=</span> <span class="n">single</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">dendrogram</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">truncate_mode</span><span class="o">=</span><span class="s2">&quot;level&quot;</span><span class="p">);</span>
<span class="c1"># p is the max depth of the tree</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/0fdbb8c3eb98705b6da6ac4da68ceddfa66389611c8086d78ebd75abdcf47a63.png" src="../../_images/0fdbb8c3eb98705b6da6ac4da68ceddfa66389611c8086d78ebd75abdcf47a63.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dendrogram</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">truncate_mode</span><span class="o">=</span><span class="s2">&quot;lastp&quot;</span><span class="p">);</span>
<span class="c1"># p is the number of leaf nodes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/2b1f65feb82ca122008c6aae04a494e7ac8f81bb74629cf5f9b096a82a45c7f3.png" src="../../_images/2b1f65feb82ca122008c6aae04a494e7ac8f81bb74629cf5f9b096a82a45c7f3.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hc_truncation_toy_demo</span><span class="p">(</span><span class="n">Z</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/31da02b41ddc76d5131e3751a147bb17275bf2c6d42404c1480748c0b925f595.png" src="../../_images/31da02b41ddc76d5131e3751a147bb17275bf2c6d42404c1480748c0b925f595.png" />
</div>
</div>
<div class="highlight-note notranslate"><div class="highlight"><pre><span></span>I’m not quite sure why we see 0 and 2 not merged for truncation_mode = &#39;level&#39; and p=1 🤔.
</pre></div>
</div>
<p><br><br></p>
<p><br><br></p>
</section>
</section>
<section id="questions-for-you-https-join-iclicker-com-fuyi">
<h2>❓❓ Questions for you https://join.iclicker.com/FUYI<a class="headerlink" href="#questions-for-you-https-join-iclicker-com-fuyi" title="Link to this heading">#</a></h2>
<section id="select-all-of-the-following-statements-which-are-true">
<h3>16.3 Select all of the following statements which are <strong>True</strong><a class="headerlink" href="#select-all-of-the-following-statements-which-are-true" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>(A) In hierarchical clustering we do not have to worry about initialization.</p></li>
<li><p>(B) Hierarchical clustering can only be applied to smaller datasets because dendrograms are hard to visualize for large datasets.</p></li>
<li><p>(C) In all the clustering methods we have seen (K-Means, DBSCAN, hierarchical clustering), there is a way to decide the granularity of clustering (i.e., how many clusters to pick).</p></li>
<li><p>(D) To get robust clustering we can naively ensemble cluster labels (e.g., pick the most popular label) produced by different clustering methods.</p></li>
<li><p>(E) If you have a high Silhouette score and very clean and robust clusters, it means that the algorithm has captured the semantic meaning in the data of our interest.</p></li>
</ul>
<p><br><br><br><br></p>
</section>
</section>
<section id="final-comments-summary-and-reflection">
<h2>Final comments, summary, and reflection<a class="headerlink" href="#final-comments-summary-and-reflection" title="Link to this heading">#</a></h2>
<section id="take-home-message">
<h3>Take-home message<a class="headerlink" href="#take-home-message" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>We saw four methods for clustering: Centroid-based clustering (K-Means), distribution-based clustering (Gaussian mixture models), density-based clustering (DBSCAN), and hierarchical clustering.</p></li>
<li><p>There are many more clustering algorithms out there which we didn’t talk about. For example see <a class="reference external" href="https://scikit-learn.org/stable/modules/clustering.html#overview-of-clustering-methods">this overview of clustering methods</a>.</p></li>
<li><p>Two important aspects of clustering</p>
<ul>
<li><p>Choice of distance metric</p></li>
<li><p>Data representation</p></li>
</ul>
</li>
<li><p>Choosing the appropriate number of clusters for a given problem is quite hard.</p></li>
<li><p>A lot of manual interpretation is involved in clustering.</p></li>
</ul>
</section>
<section id="a-few-comments-on-clustering-evaluation">
<h3>A few comments on clustering evaluation<a class="headerlink" href="#a-few-comments-on-clustering-evaluation" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>If you know the ground truth, you can use metrics such as <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.adjusted_rand_score.html">adjusted random score</a> or <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.normalized_mutual_info_score.html">normalized mutual information score</a>.</p></li>
<li><p>We can’t use accuracy scores.</p>
<ul>
<li><p>Because the labels themselves are meaningless in clustering.</p></li>
</ul>
</li>
<li><p>Usually ground truth is not available, and if it is available we would probably go with supervised models.</p></li>
</ul>
<ul class="simple">
<li><p>The silhouette score works for different clustering methods and it can give us some intuition about the quality of clusters. But it’s not very interpretable on real-world datasets.</p></li>
</ul>
<p>A couple of ways to evaluate clustering:</p>
<ul class="simple">
<li><p>Using <em>robustness-based</em> clustering metrics</p></li>
<li><p>The idea is to run a clustering algorithm or a number of clustering algorithms after adding some noise to the data or using different parameter settings and comparing outcomes.</p></li>
<li><p>If many models, perturbations, and parameters are giving the same result, the clustering is likely to be trustworthy.</p></li>
<li><p>But how do we compare clustering partitions of two different clustering models? We can use some metrics which are based on the <a class="reference external" href="http://www.comparingpartitions.info/?link=Tut14">contingency matrix</a>.</p></li>
<li><p>That said, even though all clustering models give similar results, the clusters might not capture the aspect you are interested in.</p></li>
<li><p>So you cannot really avoid manual inspection.</p></li>
<li><p>Manual inspection and analysis is tedious but remember that this is what makes data scientists valuable. We can focus on the things ML models are not good at.</p></li>
</ul>
<p><br><br></p>
</section>
</section>
<section id="resources">
<h2>Resources<a class="headerlink" href="#resources" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Check out this nice comparison of <a class="reference external" href="https://scikit-learn.org/stable/modules/clustering.html#overview-of-clustering-methods">sklearn clustering algorithms</a>.</p></li>
<li><p><a class="reference external" href="https://www.naftaliharris.com/blog/visualizing-dbscan-clustering/">DBSCAN Visualization</a></p></li>
<li><p>There is also <a class="reference external" href="https://hdbscan.readthedocs.io/en/latest/how_hdbscan_works.html">Hierarchical DBSCAN</a>.</p></li>
<li><p><a class="reference external" href="https://dashee87.github.io/data%20science/general/Clustering-with-Scikit-with-GIFs/">Clustering with Scikit with GIFs</a></p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "conda-env-cpsc330-py"
        },
        kernelOptions: {
            name: "conda-env-cpsc330-py",
            path: "./lectures/201-Lecuyer-lectures"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'conda-env-cpsc330-py'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lecture-plan-and-learning-outcomes">Lecture plan and learning outcomes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-outcomes">Learning outcomes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#select-all-of-the-following-statements-which-are-true-https-join-iclicker-com-fuyi">16.1 Select all of the following statements which are <strong>True</strong> https://join.iclicker.com/FUYI</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recap-and-motivation-video">Recap and motivation [video]</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#k-means-recap">K-Means recap</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#k-means-limitations">K-Means limitations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#k-means-limitations-shape-of-k-means-clusters">K-Means limitations: Shape of K-Means clusters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#k-means-failure-case-1">K-Means: failure case 1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#k-means-failure-case-2">K-Means: failure case 2</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#k-means-failure-case-3">K-Means: failure case 3</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dbscan-video">DBSCAN [video]</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dbscan-introduction">DBSCAN introduction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-does-it-work">How does it work?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#more-details-on-dbscan">More details on DBSCAN</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#question-for-you">Question for you</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluating-dbscan-clusters">Evaluating DBSCAN clusters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-pros-and-cons">Summary: Pros and cons</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dbscan-failure-cases">DBSCAN: failure cases</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">DBSCAN: failure cases</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#questions-for-you">❓❓ Questions for you</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">16.2 Select all of the following statements which are <strong>True</strong> https://join.iclicker.com/FUYI</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hierarchical-clustering-video">Hierarchical clustering [video]</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dendrogram">Dendrogram</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#questions-for-you-https-join-iclicker-com-fuyi">❓❓ Questions for you https://join.iclicker.com/FUYI</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#select-all-of-the-following-statements-which-are-true">16.3 Select all of the following statements which are <strong>True</strong></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#final-comments-summary-and-reflection">Final comments, summary, and reflection</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#take-home-message">Take-home message</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-few-comments-on-clustering-evaluation">A few comments on clustering evaluation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#resources">Resources</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Varada Kolhatkar
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>